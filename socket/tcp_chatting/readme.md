## 07-08. TCP CHATTING

<br>

### κ°λ° κ²°κ³Όλ¬Ό

- TCPλ¥Ό μ΄μ©ν•μ—¬ μ±„ν…μ„λ²„, μ±„ν… ν΄λΌμ΄μ–ΈνΈλ¥Ό κ°λ°ν•μ€λ‹¤.

- μ„λ²„μ—μ„λ” λ‹¨μν•κ² μ±„ν…μ— μ°Έμ—¬ν•(μ†μΌ“μ— μ—°κ²°λ) ν΄λΌμ΄μ–ΈνΈλ“¤μ„ κ΄€λ¦¬ν•λ‹¤.

- ν΄λΌμ΄μ–ΈνΈμ—μ„ μ±„ν…μ„ μ…λ ¥ν•λ©΄, μ†μΌ“μ„ ν†µν•΄ μ±„ν…μ΄ μ„λ²„λ΅ μ „μ†΅λκ³ , μ„λ²„λ” λ‹¤μ‹ μ΄λ¥Ό μ†μΌ“μ— μ—°κ²°λ λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ— μ±„ν…μ„ λ‹¤μ‹ λ³΄λ‚΄κ² λλ‹¤.

<br/>

### μ†μ¤μ½”λ“ μ†κ°

π‘€ μ½”λ“ μƒμ μ£Όμ„μΌλ΅ μ„¤λ…λμ–΄ μμΌλ―€λ΅ ν•µμ‹¬μ΄λΌ μƒκ°λλ” κ²ƒλ§ κ°„λµν•κ² μ†κ°

- client λ“¤μ„ κ΄€λ¦¬ν•λ” λ¦¬μ¤νΈλ¥Ό μƒμ„±ν•μ—¬, μ΄λ¥Ό μ΄μ©ν•μ—¬ ν΄λΌμ΄μ–ΈνΈλ¥Ό κ΄€λ¦¬ν•μ€λ‹¤.

  ```js
  // μ±„ν…μ— μ ‘μ†ν• ν΄λΌμ΄μ–ΈνΈλ“¤μ„ κ΄€λ¦¬ν•  λ¦¬μ¤νΈ.
  const groupQueue = []; // μ¶”ν›„ κ΄€λ¦¬ν•λ” λ¶€λ¶„μ€ λ„λ¬΄ λ§μ•„ μ†μ¤μ½”λ“μ—μ„ ν™•μΈ.
  ```

- μ΄μ „κΉμ§€λ” `socket.end` λ¥Ό μ λ€λ΅ ν™μ©ν•μ—¬ FIN ν¨ν‚·μ„ μ΄μ©ν•μ—¬ μ •μ„λ€λ΅ μΆ…λ£ν•λ” κ²ƒμ„ ν•΄λ³΄μ§€ μ•μ•μ—λ‹¤. μ—¬κΈ°μ„λ” μ΄λ¥Ό μ λ€λ΅ κµ¬ν„ν•΄λ³΄μ•λ‹¤.

  ```js
  /* ----------- clinet --------------*/
  // ν΄λΌμ΄μ–ΈνΈμ—μ„ quitμ„ ν†µν•΄ FINμ„ λ³΄λ‚΄λ©΄, ν΄λΌμ΄μ–ΈνΈλ” λ³΄λ‚΄λ” κ²ƒμ„ μ¤‘μ§€ν•κ³  λ°›κΈ°λ§ ν•  μ μκ² λλ‹¤.
  // μ΄λ–„ μ—°κ²°μ΄ μ™„μ „ν λκΈ΄ κ²ƒμ€ μ•„λ‹κΈ° λ•λ¬Έμ— half-close λΌκ³  μ΄μ•ΌκΈ°ν•λ‹¤.
  if (input === "quit") {
    socket.end();
  }

  /* ----------- server --------------*/
  // socket.on("end", () => {}) μ—μ„ FIN ν¨ν‚·μ΄ λ“¤μ–΄μ¨ κ²ƒμ„ listenν•κ³  callback ν•¨μλ¥Ό μν–‰ν•λ‹¤.
  socket.on("end", () => {
    try {
      socket.end(); // ν΄λΌμ΄μ–ΈνΈμ—κ² FIN ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.
    } catch {
      console.log("socket destroy error");
    }
  });

  /* ----------- clinet --------------*/
  // server μ½μ—μ„  FIN ν¨ν‚·μ„ λ³΄λƒμΌλ―€λ΅ μ΄λ¥Ό ν™•μΈν•κ³  clientμ—μ„ μ†μΌ“μ—°κ²°μ„ μΆ…λ£ν•  κ²ƒμ΄λ‹¤.
  // μ΄λ• μ†μΌ“ μ—°κ²°μ΄ λμ–΄μ§„ κ²ƒμ„ ν™•μΈν•λ” μ΄λ²¤νΈ λ¦¬μ¤λ„ socket.on("close", () => {}) κ°€ μν–‰λ  κ²ƒμ΄λ‹¤.
  socket.on("close", () => {
    console.log("> echo-client is de-activated");
    r.close();
    exit(1);
  });

  /* ----------- server --------------*/
  // μ„λ²„μ—μ„λ„ λμ–΄μ΅μμ΄ ν™•μΈλκ³  μ΄λ²¤νΈ λ¦¬μ¤λ„ socket.on("close", () => {}) κ°€ μν–‰λ  κ²ƒμ΄λ‹¤.
  socket.on("close", () => {
    console.log("> someone disconnect");
  });
  ```

<br/>

### λ°λ¨μμƒ μ†κ°

- μ„λ²„ ν”„λ΅κ·Έλ¨ λ™μ‘μ‹ν‚¤λ©΄, tcp μ±„ν… μ„λ²„κ°€ λ™μ‘ν•λ‹¤.
- ν΄λΌμ΄μ–ΈνΈ ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰μ‹ν‚¤λ©΄ ν΄λΌμ΄μ–ΈνΈκ°€ tcp μ±„ν… μ„λ²„μ— μ—°κ²°λκ³ , κ·Έκ²ƒμ— λ€ν• μ •λ³΄κ°€ μ¶λ ¥λλ‹¤.
- μ±„ν…μ„ λ³΄λ‚΄λ©΄, μ±„ν…μ΄ μ„λ²„λ΅ μ „μ†΅λκ³ , μ„λ²„μ—μ„ λ‹¤μ‹ μ±„ν…λ°© μ•μ— μλ” λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ—κ² μ±„ν…μ΄ λ³΄λ‚΄μ§„λ‹¤.

<br/>

### λλ‚€μ 

- μ±„ν…μ΄ μ–΄λ–»κ² λ™μ‘ν•λ”μ§€ κ·Έ μμ„Έν• λ‚΄μ©μ„ κµ¬ν„μ„ ν†µν•΄ λ°°μΈμ μμ—λ‹¤.
- μ΄μ „μ— μΈν„΄μ„ ν•λ©΄μ„ μ†μΌ“μ— λ€ν• λ‚΄μ©μ„ μ λ¨λ¥΄κ³ , μ±„ν…μ„ κµ¬ν„ν–μ—λ μ μ΄ μμ—λ”λ°, μ΄ κ³Όμ •μ„ ν†µν•΄ μ†μΌ“ κΈ°λ°μ μ±„ν…μ— λ€ν•΄ μΆ€ λ” μ μ΄ν•΄ν•  μ μλ” κΈ°νκ°€ λμ—λ κ²ƒ κ°™λ‹¤.

<br/>

---

#### π› κµ¬ν„ν• μ½”λ“μ λ‚΄μ©μ— λ€ν• μμ„Έν• μ„¤λ…μ€ js νμΌ μ•μ— μ£Όμ„μΌλ΅ μ²¨λ¶€λμ–΄μμµλ‹λ‹¤.

#### π λ”°λΌμ„ ν•µμ‹¬μ΄λΌ μƒκ°λλ” μ½”λ“λ¥Ό μ μ™Έν• λ‚λ¨Έμ§€ μ½”λ“μ— λ€ν• μμ„Έν• λ‚΄μ©μ€ ν•΄λ‹Ή readmeμ—μ„ μ μ™Έν•μ€μµλ‹λ‹¤.
